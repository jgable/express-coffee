// Generated by CoffeeScript 1.4.0
var defaults, makeAppSettingsHandler, _extend,
  __hasProp = {}.hasOwnProperty;

defaults = {
  data: function(req, resp) {
    return {
      isLoggedIn: resp.user != null,
      user: resp.user
    };
  },
  name: "APPLICATION_SETTINGS"
};

_extend = function(child, parent) {
  var key, val;
  for (key in parent) {
    if (!__hasProp.call(parent, key)) continue;
    val = parent[key];
    child[key] = val;
  }
  return child;
};

makeAppSettingsHandler = function(opts) {
  var settings;
  settings = _extend(defaults, opts);
  return function(req, resp, next) {
    global.appSettings = settings.data(req, resp);
    global.exportAppSettings = function() {
      return "<script type=\"text/javascript\">\n    var " + settings.name + " = " + (JSON.stringify(global.appSettings || {})) + ";\n</script>";
    };
    return next();
  };
};

module.exports = makeAppSettingsHandler;
